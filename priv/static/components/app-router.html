<template id="content">
</template>

<script>
    class AppRouter extends HTMLElement {

        constructor() {
            super();

            // Map with functions for commands i.e. the attribute name
            this.attrCommands = {
                element: (oldValue, newValue) => {
                    console.log(`oldValue: ${oldValue}, newValue: ${newValue}`);
                    if (oldValue === newValue) {
                        console.log("Skipping...no application state change.");
                        return;
                    }
                    this.shadowRoot.childNodes.forEach(function(child) {
                        this.removeChild(child)
                    }.bind(this.shadowRoot));
                    this.shadowRoot.appendChild(document.createElement(newValue));
                }
            };

            this.routes = {};

            this.attachShadow({mode: 'open'});
        }

        static get observedAttributes() {
            return ['element']
        }

        attributeChangedCallback(attr, oldValue, newValue) {
            AppRouter.observedAttributes.map(attr => {
                this.attrCommands[attr](oldValue, newValue);
            });
        }

        connectedCallback() {
            this.currentContentElement = document.currentScript.ownerDocument.querySelector("#content");

            window.addEventListener('popstate', this.stateChange.bind(this), false);

            for(let i = 0; i < this.childElementCount; i++) {
                let [path, element] = [this.children[i].attributes.getNamedItem("path").value, this.children[i].attributes.getNamedItem("element").value];
                this.routes[path] = element;
            }

            this.stateChange(this);
        }

        stateChange(router) {
            let hash = window.location.hash;
            this.setAttribute('element', this.routes[hash]);
        }
    };

    customElements.define('app-router', AppRouter);
</script>